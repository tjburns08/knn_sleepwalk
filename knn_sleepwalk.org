#+Title: Knn Sleepwalk
#+Author: Tyler Burns
#+Date: April 2, 2024
#+Purpose: A log and random notes around the project

* 2024
** April
*** April 2
The intent here is to make a LinkedIn post. A couple of things to log. The first is the UMAP on the inverted distance matrix, which I totally don't understand but might have some utility somehow.

First the regular UMAP.
[[file:images/2024-04-02_09-51-01_Screenshot 2024-04-02 at 09.50.59.png]]

And now the inverted one.
[[file:images/2024-04-02_09-51-23_Screenshot 2024-04-02 at 09.51.21.png]]

Perhaps the center of the umap denotes the cells that are the farthest from the most other cells. There are some questions around what the intersections are and what the lines are. Again this is an inverted distance matrix of the original manifold. As opposed to the inverted distance matrix of umap space itself. So its a more complex thing.

Ok, so now for some questions for the post.
- How is KFN informative in a way that KNN isn't. How is KFN more informative than just looking at raw distances or inverted raw distances, which I have also done?
- How can we best communicate the concept of KFN? Should we make the cursor bigger accordingly?
- What are the main points of the post, and the respective sub-points?
- What key insights will be the most useful for the audience? What bias will be corrected. Again, how is this independent from the KNN post?

And onto the message.

-----
One way to understand how much global information UMAP can (and cannot) preserve: look at the K-farthest neighbors (KFN) of cells in UMAP space versus high-dimensional space. Here is what I mean:

Below is a UMAP from the flagship "PBMC 3k" single-cell RNA sequencing dataset, with 2700 cells. I am using my modification of Sleepwalk (by S. Ovchinnikova and S. Anders, link in comments) to highlight the top 10% farthest neighbors (270) for each cell the cursor is on. This is what is meant by KFN. Left side is KFN of UMAP space, right side is the KFN of the first 10 principal components, from which you do the clustering and dimension reduction in single-cell sequencing.

The first thing to notice is that the KFN in UMAP space and high-dimensional space look nothing like each other, pointing to limitations in UMAP's ability to capture global information.

The second thing to notice is that there is information that is hard to capture in 2 dimensions. In particular, there is a region to the middle right of the UMAP that seems to be the farthest away from the majority of the dataset, including cells that are quite nearby in UMAP space. One way to make sense of this is to imagine a third dimension where the cells are pointing outward and far away from the rest of the data. But note that in reality we're dealing with 8 extra dimensions here, not 1 extra dimension. Thus, there will be all kinds of complexity at the global level that is hard to capture in 2 dimensions.

UMAP claims to capture global structure better than t-SNE, and this topic is a rabbit hole once you start looking at initialization steps for the respective tools. But the point is that global structure is very complex, so even if a tool does a better job than another tool at capturing global structure in 2 dimensions, it doesn't mean that it's perfect. Or anywhere near perfect. Don't let claims like these bias you, as they initially biased me.

This post is a followup to my previous "KNN sleepwalk" post, where I compare the K-nearest neighbors of UMAP space versus high-dimensional space directly on the UMAP. If you missed that, please go to the link in the comments.

If you want to use this KFN (and the respective KNN) sleepwalk tool for your data and work, please go to the project's GitHub, which I will also link in the comments. If you want me to walk you through its use, just send me a direct message. Thank you and I hope you all have a great day.
-----
Comment: The original sleepwalk project and its paper can be found here: https://anders-biostat.github.io/sleepwalk/. The GitHub for my project, called KNN Sleepwalk, can be found here: https://github.com/tjburns08/knn_sleepwalk. My previous post on KNN sleepwalk, in case you missed it, can be found here: https://www.linkedin.com/feed/update/urn:li:activity:7169341694348324865/

Now we have to remember how we converted the mov into a gif. This is why we keep these notes in orgmode (or wherever, really). If I recall, it was a command line tool.

Ah.

#+begin_src
ffmpeg -i kfn_umap_vs_pca_labeled.mov kfn_umap_vs_pca_labeled.gif
#+end_src

Ok, is there anything else I can do here? We can double check with the inverted distance matrix. Done. We have this in the output folder.

Now what do we do? We can make the LI post now and schedule it to be posted at a particular time independent of me, or we can post it immediately after the call with the Israelis. I think we can go with the latter.

Let's do one more pass on the post. Done. Just in time for lunch, prep for the Israelis, then the call, then protein, then post, then gym. Cool.

Reminder to do a post on the inverted UMAP. Maybe if we start with simple structures like a circle or whatever, then we'll get somewhere. Maybe we can create an embedding that is a mix of the two. Consider just coloring the inverted UMAP by the different markers directly in the PBMC 3k dataset. Or by Cluster ID. Whatever. This will be super weird.

Need to change the frame rate...the arrow is moving too slow:

#+begin_src
ffmpeg -i kfn_umap_vs_pca_labeled.mov -r 10 kfn_umap_vs_pca_labeled_fr_10.gif
#+end_src

Worked fine.

LI post made. Posted at 14:15 or so. Would ideally liked to have posted at 15:00 or 16:00 but that's ok. I am proud of the work I put into this one. And remember its an iteration of a previous one. It's time to go to the gym.
*** April 5
Got a working prototype of biaxial sleepwalk up.
